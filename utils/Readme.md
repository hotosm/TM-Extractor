# Result Analysis Metrics

This Python script analyzes result json data and provides various metrics about the tasks, datasets, and resources within the result file generated by --track feature of ```tm_extractor.py```.

## Run
```bash
python result_analyzer.py your_result_json_path
```

## Metrics Explanation

### `total_tasks`

Total number of tasks present in the JSON file.

Example: 2

### `successful_tasks`

Number of tasks that completed successfully.

Example: 1

### `failed_tasks`

Number of tasks that failed.

Example: 1

### `total_datasets`

Total number of datasets present across all tasks.

Example: 2

### `total_resources`

Total count of resources (e.g., files : each exports such as kml/shp) across all datasets and tasks.

Example: 12

### `total_elapsed_time`

The total elapsed time from the earliest `started_at` timestamp to the latest `last_modified` timestamp across all tasks.

Example: "0:00:21"

### `dataset_counts`

A dictionary showing the count of resources for each dataset type.

Example:
```json
{
  "Waterways": 6,
  "Buildings": 6
}
```

## Example Explanation 

For following JSON
```json
{
  "a221affc-0e50-4231-92b5-3d0f4438f170": {
    "datasets": [
      {
        "Waterways": {
          "resources": [
            {
              "name": "hotosm_project_9_waterways_lines_geojson.zip",
              "format": "geojson",
              "description": "Waterway GeoJSON",
              "url": "https://example.com/data/hotosm_project_9_waterways_lines_geojson.zip",
              "last_modified": "2023-12-28T17:48:21.378667"
            },
            {
              "name": "hotosm_project_9_waterways_lines_kml.zip",
              "format": "kml",
              "description": "Waterway KML",
              "url": "https://example.com/data/hotosm_project_9_waterways_lines_kml.zip",
              "last_modified": "2023-12-28T17:48:21.378974"
            }
          ]
        }
      }
    ],
    "elapsed_time": "11 seconds",
    "started_at": "2023-12-28T17:48:10.076621"
  },
  "4a20c25a-a173-4082-a9e7-d5d6e7244809": "FAILURE"
}
```
In this example, the "Waterways" dataset contains two resources ("waterway_line_geojson" and "waterway_line_kml") within the task "a221affc-0e50-4231-92b5-3d0f4438f170". The total count of resources for this dataset is 2.

**Metrics Breakdown:**

- `total_tasks`: 2
- `successful_tasks`: 1 (Task "a221affc-0e50-4231-92b5-3d0f4438f170" succeeded)
- `failed_tasks`: 1 (Task "4a20c25a-a173-4082-a9e7-d5d6e7244809" failed)
- `total_datasets`: 1 (Dataset "Waterways" in the successful task)
- `total_resources`: 2 (Two resources in the "Waterways" dataset)
- `total_elapsed_time` (```hour:min:sec```): "0:00:11" (Elapsed time from the start of the successful task to the last resource modification) 
- `resource_counts`: {"Waterways": 2} (Count of resources for the "Waterways" dataset, its the breakdown resource count for each dataset )

**TM Definition:** 

Each task reflects to single tasking manager project extraction request , For this example , for tasking manager project no 9 , It created task with task id ```a221affc-0e50-4231-92b5-3d0f4438f170```. From TM perspective it had mapping type ```waterways``` which reflected as a dataset in rawdata api , if there are multiple mapping type such as ```building```, ```roads``` they will be treated as 3 different datasets inside same task ! Inside each dataset it contains resources which are the actual exports files generated based on the geometry type and file format . On above example for ```waterways``` mapping type , it generated two ```line``` resources because in input it had -> geometry type : ```line``` and export formats ```geojson``` , ```kml```.  if for some mapping type there are multiple geometry types such as ```landuse``` then it will produce the resources accordingly . 

- `no of resources for datasets` = no of geometry_type * no of file_formats 
- `task` = TM Project extraction request 
- `datasets` = TM Mapping Types 
- `resources` = Actual exports wrt feature type and file formats 
